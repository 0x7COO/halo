language: node_js
node_js: stable
cache: npm

jobs:
  include:
    - stage: build
      script:
        - npm run build
        - scripts/zip_dist.sh
    - stage: release
      script: echo "Releasing to Github Release..."
      deploy:
        provider: releases
        api_key: $GITHUB_OAUTH_TOKEN
        file_glob: true
        file: dist/*.zip
        on:
          tags: true
stages:
  - build
  - name: release
    if: tag =~ /^v\d+\.\d+(\.\d+)?(-\S*)?$/
branches:
  only: /^v\d+\.\d+(\.\d+)?(-\S*)?$/
